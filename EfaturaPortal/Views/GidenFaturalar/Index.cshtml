@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}
<div class="row">

</div>
<div class="row">
    <div class="col-12">
        <div class="card">

            <div class="card-header">
                <form id="filtrealani" novalidate>
                    <div class="row">

                        <div class="col-md-2">
                            <div class="form-group">
                                <label class="form-control-label">Fatura Numarası</label>
                                <input class="form-control" data-placeholder="" autocomplete="off" placeholder="Fatura Numarası" id="Tx_Src_fatno" name="FaturaNumarasi" />
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                <label class="form-control-label">Vergi Numarası</label>
                                <input class="form-control" data-placeholder="" autocomplete="off" placeholder="Müşteri VKN" id="Tx_Src_vkn" name="Vdno" />
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                <label class="form-control-label">Müşteri Ünvanı</label>
                                <input class="form-control" data-placeholder="" autocomplete="off" placeholder="Müşteri Ünvanı" id="Tx_Src_unvan" name="Unvan" />
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                <label class="form-control-label">Fatura İlk Tarihi</label>
                                <input class="form-control" data-placeholder="" autocomplete="off" placeholder="" id="Tx_Src_tarih" name="IlkTarih" />
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                <label class="form-control-label">Fatura Son Tarihi</label>
                                <input class="form-control" data-placeholder="" autocomplete="off" placeholder="" id="Tx_Src_son_tarih" name="SonTarih" />
                            </div>
                        </div>

                    </div>
                </form>
                <div class="row">
                    <div class="col-md-2">
                        <input type="radio" name="FaturaTuru" id="faturaturu1" value="hepsi" />
                        <label class="form-control-label">Hepsi</label>

                        <input type="radio" name="FaturaTuru" id="faturaturu2" value="E-Fatura" />
                        <label class="form-control-label">E-Fatura</label>

                        <input type="radio" name="FaturaTuru" id="faturaturu3" value="E-Arsiv" />
                        <label class="form-control-label">E-Arşiv</label>
                    </div>
                    <div class="col-md-2">
                        <button class="btn btn-primary btn-filtre">Filtrele</button>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <table class=" table table-striped- table-bordered table-hover table-checkable" id="table">
                    <thead>
                        <tr>

                            <th>Seç</th>
                            <th>İşlemler</th>
                            <th>Durum</th>
                            <th>Fatura Türü</th>
                            <th>Tarih</th>
                            <th>Fatura No</th>
                            <th>Müşteri Ünvanı</th>
                            <th>Müşteri VKN</th>
                            <th>Email</th>
                            <th>Toplam</th>
                            <th>Kdv Tutar</th>
                            <th>Genel Toplam</th>
                        </tr>
                    </thead>
                </table>
            </div>
        </div>

    </div>
</div>

@section css
{
    <link href="~/plugins/adminLte/plugins/daterangepicker/daterangepicker.css" rel="stylesheet" />
    <link href="~/plugins/adminLte/plugins/datatables-select/css/select.bootstrap4.css" rel="stylesheet" />
    <style>
        .notiflix-block-position {
            min-height: 0px !important;
        }
    </style>
}


@section Scripts
{
    <script src="~/plugins/adminLte/plugins/inputmask/jquery.inputmask.min.js"></script>
    <script src="~/plugins/adminLte/plugins/daterangepicker/daterangepicker.js"></script>
    <script src="~/plugins/adminLte/plugins/datatables-select/js/dataTables.select.js"></script>
    <script>



        $(function () {

            //Date range picker with time picker
            $('input[id*="tarih"').daterangepicker({
                timePicker: true,
                autoApply: true,
                timePicker24Hour: true,
                singleDatePicker: true,
                timePickerIncrement: 30,
                locale: {
                    format: 'DD.MM.YYYY',
                    applyLabel: "Uygula",
                    cancelLabel: "İptal",
                    daysOfWeek: [
                        "Pz",
                        "Pts",
                        "Sa",
                        "Çar",
                        "Per",
                        "Cu",
                        "Cts"
                    ],
                    monthNames: [
                        "Ocak",
                        "Şubat",
                        "Mart",
                        "Nisan",
                        "Mayıs",
                        "Haziran",
                        "Temmuz",
                        "Ağustos",
                        "Eylül",
                        "Ekim",
                        "Kasım",
                        "Aralık"
                    ],
                    firstDay: 1
                }
            },
                function (start, end, label) {

                })

        });

        $(document).ready(function () {
            getData("GidenFaturalar/GetAll", "false");
        });

        var getData = function (url, filtre) {

            var formData = null;

            if (filtre == "true") {

                //var formData = { faturaNumarasi: $("#Tx_Src_fatno").val(), Unvan: $("#Tx_Src_unvan").val(), vdno: $("#Tx_Src_vkn").val(), ilkTarih: $('#Tx_Src_tarih').data('daterangepicker').startDate, sonTarih: $('#Tx_Src_tarih').data('daterangepicker').endDate };

                //formData.append("FaturaNumarasi", $("#Tx_Src_fatno").val());
                //formData.append("Unvan", $("#Tx_Src_unvan").val());
                //formData.append("Vdno", $("#Tx_Src_vkn").val());
                //formData.append("IlkTarih", $('#Tx_Src_tarih').data('daterangepicker').startDate);
                //formData.append("SonTarih", $('#Tx_Src_tarih').data('daterangepicker').endDate);

                formData = $("#filtrealani").serialize();
            }
            console.log(formData);
            $.ajax({
                url: url,
                type: "POST",
                cache: false,
                contentType: 'application/x-www-form-urlencoded; charset=UTF-8', // when we use .serialize() this generates the data in query string format. this needs the default contentType (default content type is: contentType: 'application/x-www-form-urlencoded; charset=UTF-8') so it is optional, you can remove
                processData: false,
                data: formData,
                complete: function () {

                },
                success: function (data) {

                    console.log(data);
                    var dataTable = $('#table').DataTable({
                        destroy: true,
                        responsive: true,
                        dom: "<'row'<'col-sm-8 text-left'B>><'row'<'col-sm-12'tr>><'row'<'col-sm-12 col-md-5'i><'col-sm-12 col-md-7 dataTables_pager'lp>>",
                        lengthHappyHour: [[5, 10, 25, 50, -1], ["50 Kayıt", "100 Kayıt", "200 Kayıt", "250 Kayıt", "Hepsi"]],
                        pageLength: 50,

                        columnDefs: [{
                            orderable: false,
                            className: 'select-checkbox',
                            targets: 0
                        }],
                        select: {
                            style: 'os',
                            selector: 'td:first-child'
                        },
                        language: {
                            "emptyTable": "Kayıt bulunamadı",
                            "info": "_START_ - _END_ arası kayıtlar",
                            "infoEmpty": "Kayıt bulunamadı",
                            "infoFiltered": "(_MAX_ kayıt arasından filtrelendi)",
                            "lengthHappyHour": "_HappyHour_",
                            "search": "",
                            "searchPlaceholder": "Arama",
                            "zeroRecords": "Kayıt bulunamadı",
                            "lengthMenu": "Gösterilen _MENU_  Kayıt",
                        },
                        /*order: [[6, 'desc']],*/
                        buttons: [
                            {
                                text: 'Yeni Fatura',
                                className: 'btn-warning EfaturaPortalApp-datatables-create',
                                attr: {
                                    "data-endpoint": "",
                                    title: "Yeni Fatura Ekle"
                                },
                            },

                            { extend: 'print', text: 'Listeyi Yazdır' },
                            //{ extend: 'copyHtml5', text: 'Kopyala' },
                            { extend: 'excelHtml5', text: 'Excel' },
                            { extend: 'csvHtml5', text: 'CSV' },
                            { extend: 'pdfHtml5', text: 'PDF' },
                            // { extend: 'colvis', text: 'Göster' }
                        ],
                        columns: [

                            {
                                targets: 0,
                                data: null,
                                defaultContent: '',
                                orderable: false,
                                className: 'select-checkbox'
                            },

                            {
                                data: null,
                                className: "",
                                targets: -1,
                                orderable: false,
                                width: "100px",
                                render: function (data, type, full, meta) {

                                    return '<button class="col-5 btn btn-info font-weight-bold btn-pill mr-2  min-w-90px EfaturaPortalApp-datatables-view gridIslemBtn"  title="Görüntüle" data-endpoint="SeriNumaralar/Update" data-id="' + full.id + '"><i class="fas fa-eye"></i></button>' +
                                        '<button class="col-5 btn btn-info font-weight-bold btn-pill mr-2  min-w-90px EfaturaPortalApp-datatables-print gridIslemBtn" title="Görüntüle" data-endpoint="SeriNumaralar/Update" data-id="' + full.id + '"><i class="fas fa-print"></i></button>';
                                }
                            },
                            {
                                "data": "efaturaDurum",
                                "render": function (data, type, row) {
                                    switch (data) {

                                        case 0: return "<div class='btn btn-warning'>Beklemede</div>";
                                        case 1: return "<div class='btn btn-primary'>Yüklendi</div>";
                                        case 2: return "<div class='btn btn-success'>Gönderildi</div>";
                                        case 3: return "<div class='btn btn-danger'>İptal Edildi</div>";

                                    }
                                }
                            },
                            {
                                "data": "faturaTuru",
                                "render": function (data, type, row) {
                                    switch (data) {

                                        case 0: return "<div class='btn btn-primary'>E-Fatura</div>";
                                        case 1: return "<div class='btn btn-secondary'>E-Arşiv</div>";


                                    }
                                }

                            },
                            {

                                "data": "tarih",
                                "render": function (data, type, row) {
                                    return moment(data).format("DD.MM.YYYY HH:mm")
                                }

                            },
                            { "data": "faturaNumarasi" },
                            { "data": "cariler.unvani" },
                            { "data": "cariler.vergiNumarasi" },
                            { "data": "cariler.email" },
                            { "data": "toplam" },
                            { "data": "kdv" },
                            { "data": "odenecekTutar" },



                        ],

                        "createdRow": function (row, data, dataIndex) {
                            if (data.iade) {
                                $(row).css({ "background-color": "#FFCFCF" });
                            }
                        },
                        data: data
                    });

                    dataTable.on('order.dt search.dt', function () {
                        dataTable.column(0, { search: 'applied', order: 'applied' }).nodes().each(function (cell, i) {
                            cell.innerHTML = i + 1;
                        });
                    }).draw();
                }
            });
        };


        $(document).on("click", ".btn-filtre", function () {


            getData("GidenFaturalar/GetAllbyFiltre", "true");


        });
    </script>

}